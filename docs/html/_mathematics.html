<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LMA: Mathematics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LMA
   </div>
   <div id="projectbrief">Lightweight Metrology for AC</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_mathematics.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Mathematics </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page outlines the key formulae, principles, and concepts forming the mathematical foundations of AC metrology used within LMA.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Context"></a>
Context</h1>
<p>In metrology, measurements begin at the raw ADC level, where we acquire <b>discretised instantaneous samples</b> of both voltage and current.</p>
<p>Thus, we have: \( v(t) \) and \( i(t) \)<br  />
 Specifically in the form of ADC samples: \( V_\mathrm{adc_n} \) &amp; \( I_\mathrm{adc_n} \)</p>
<p>These represent the instantaneous voltage and current waveforms. <br  />
 All subsequent calculations—RMS, power, and energy—are derived directly from these sampled signals.</p>
<div class="image">
<img src="VI_Sampling.png" alt="" width="30%" height="30%"/>
<div class="caption">
Voltage and Current sampling from ADC</div></div>
<hr  />
<h1 class="doxsection"><a class="anchor" id="RMS"></a>
RMS</h1>
<p>When analysing AC systems, we are often interested in average quantities. <br  />
 However, since the average of a pure sine wave over one period is zero, using a simple mean would yield no useful measurement of power or energy. <br  />
 Instead, we use the <b>Root Mean Square (RMS)</b>, which represents an AC systems equivalent DC value.</p>
<p>Mathematically:   </p><p class="formulaDsp">
\[x_\mathrm{RMS} = \sqrt{ \frac{1}{N} \sum_{n=1}^{N} x_n^2 }
\]
</p>
<p>This concept forms the <b>foundation of AC metrology</b>.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Voltage"></a>
Voltage</h1>
<p>Using the instantaneous voltage signal \( v(t) \), the RMS value is:</p>
<p class="formulaDsp">
\[V_\mathrm{RMS} = \sqrt{ \frac{1}{T} \int_0^T [v(t)^2] \, dt }
\]
</p>
<p>In discrete digital form (using ADC samples):   </p><p class="formulaDsp">
\[V_\mathrm{RMS} = \sqrt{ \frac{1}{N} \sum_{n=1}^{N} [V_\mathrm{adc_n}^2] }
\]
</p>
<p>Where:</p><ul>
<li>\( N \) = number of samples <br  />
</li>
<li>\( V_\mathrm{adc_n} \) = voltage sample</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Current"></a>
Current</h1>
<p>Similarly, for current:   </p><p class="formulaDsp">
\[I_\mathrm{RMS} = \sqrt{ \frac{1}{T} \int_0^T [i(t)^2] \, dt }
\]
</p>
<p>Discrete form:   </p><p class="formulaDsp">
\[I_\mathrm{RMS} = \sqrt{ \frac{1}{N} \sum_{n=1}^{N} [I_\mathrm{adc_n}^2] }
\]
</p>
<p>Where:</p><ul>
<li>\( N \) = number of samples <br  />
</li>
<li>\( I_\mathrm{adc_n} \) = current sample</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Frequency"></a>
Frequency</h1>
<p>In AC systems, frequency refers to the fundamental line frequency, typically 50 Hz or 60 Hz depending on the region.<br  />
 Accurate frequency measurement is crucial for power computation, phase determination, and system diagnostics.<br  />
 A common digital approach is to first filter the voltage signal to isolate the fundamental component and remove high-frequency noise or harmonics, then perform zero-crossing detection on the filtered waveform.<br  />
 Zero-crossing detection identifies points where the voltage waveform passes through zero in a defined direction (negative-to-positive or positive-to-negative), which serve as time markers of the AC cycle. </p><div class="image">
<img src="Zero_crossing_2.png" alt="" width="30%" height="30%"/>
<div class="caption">
Zero Crossing Detection - https://en.wikipedia.org/wiki/Zero_crossing</div></div>
<p>In a digital system, the voltage signal is represented by discrete ADC samples, \( V_\mathrm{adc_n} \), where \( n \) indexes the sample.<br  />
 A zero crossing occurs between samples \( V_\mathrm{adc_n} \) and \( V_\mathrm{adc_{n+1}} \) where the sign of the voltage changes.<br  />
 The frequency can then be calculated as:   </p><p class="formulaDsp">
\[f = \frac{1}{N \cdot \delta_t} [Hz]
\]
</p>
<p>Where:</p><ul>
<li>\( N \) = number of ADC samples between consecutive zero crossings of the same polarity</li>
<li>\( \delta_t \) = sampling interval (seconds)</li>
<li>\( V_\mathrm{adc_n} \) = voltage ADC sample at index \( n \)</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Power"></a>
Power</h1>
<p>Power in AC systems is derived directly from voltage and current waveforms defined as:   </p><p class="formulaDsp">
\[v(t) = V_\mathrm{m} \sin(2 \pi f t)
\]
</p>
   <p class="formulaDsp">
\[i(t) = I_\mathrm{m} \sin(2 \pi f t)
\]
</p>
<p>Where:</p><ul>
<li>\( V_\mathrm{m} \) = peak voltage</li>
<li>\( I_\mathrm{m} \) = peak current</li>
<li>\( f \) = line frequency</li>
<li>\( t \) = time</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="PhaseShift"></a>
Phase Shift</h2>
<p>An important topic to cover before going into power computations however is the phase relationship of current and voltage.<br  />
 Current and voltage are often <b>out of phase</b> due to reactive components (inductors or capacitors). <br  />
 The angular displacement between them is the <b>phase shift</b>, \( \phi \), a key parameter for determining active and reactive power.<br  />
 This means we must modify our voltage and current signals to better represent the system:   </p><p class="formulaDsp">
\[v(t) = V_\mathrm{m} \sin(2 \pi f t)
\]
</p>
   <p class="formulaDsp">
\[i(t) = I_\mathrm{m} \sin(2 \pi f t + \phi)
\]
</p>
<p>Where \( \phi \) denotes the phase angle:</p><ul>
<li><b>Positive</b> ( \( \phi &gt; 0 \)): current leads voltage (capacitive load) <br  />
</li>
<li><b>Negative</b> ( \( \phi &lt; 0 \)): current lags voltage (inductive load)</li>
</ul>
<div class="image">
<img src="VI_Sin.png" alt="" width="30%" height="30%"/>
<div class="caption">
V-I Sinusiodal - https://www.electronics-tutorials.ws/accircuits/phase-difference.html</div></div>
<p>This is often nicely shown in the form of a phasor diagram. </p><div class="image">
<img src="PhaseShift_Vector.png" alt="" width="30%" height="30%"/>
<div class="caption">
V-I Phasor - https://www.electronics-tutorials.ws/accircuits/phasors.html</div></div>
<h2 class="doxsection"><a class="anchor" id="ApparentPower"></a>
Apparent Power</h2>
<p>Apparent power \( S \), measured in \( VoltAmperes [VA] \), represents the total system power (both useful and reactive components):   </p><p class="formulaDsp">
\[S = V_\mathrm{RMS} I_\mathrm{RMS}
\]
</p>
<p>Discrete form:   </p><p class="formulaDsp">
\[S = \frac{1}{N} \sqrt{ \sum_{n=1}^{N} [V_\mathrm{adc_n}^2] \cdot \sum_{n=1}^{N} [I_\mathrm{adc_n}^2] }
\]
</p>
<h2 class="doxsection"><a class="anchor" id="ActivePower"></a>
Active Power</h2>
<p>Active (real) power \( P \), measured in \( Watts [W] \), is the component that performs useful (resistive) work:   </p><p class="formulaDsp">
\[P = \frac{1}{T} \int_0^T [v(t) i(t)] dt
\]
</p>
<p> Discrete form:   </p><p class="formulaDsp">
\[P = \frac{1}{N} \sum_{n=1}^{N} [V_\mathrm{adc_n} I_\mathrm{adc_n}]
\]
</p>
<h2 class="doxsection"><a class="anchor" id="ReactivePower"></a>
Reactive Power</h2>
<p>Reactive (imaginary) power \( Q \), measured in \( VoltAmperesReactive [VAR] \), is the component that performs no net work in the system.<br  />
 It represents energy exchanged with inductive or capacitive components.<br  />
 We can understand reactive power by recalling three key points about phase relationships:</p><ul>
<li>A purely resistive load has 0° phase shift between voltage and current.</li>
<li>A purely reactive load has a 90° phase shift between voltage and current.</li>
<li>Instantaneous active power is always given by \( p(t) = v(t) \cdot i(t) \).</li>
</ul>
<p>From this, we can derive an important concept, if we artificially shift the current waveform by 90°, the resulting active power becomes zero, leaving only the reactive component.</p>
<p>Therefore mathematically introducing a 90° shift in current gives:   </p><p class="formulaDsp">
\[    q(t) = v(t) \cdot i(t - 90^\circ) = V_\mathrm{pk} \sin(2 \pi f t) \cdot I_\mathrm{pk} \sin(2 \pi f t + \phi - 90^\circ) 
\]
</p>
<p> Discrete form:   </p><p class="formulaDsp">
\[    Q = \frac{1}{N} \sum_{n=1}^{N} [V_\mathrm{adc_n} \cdot I_\mathrm{adc_n-90^\circ}] 
\]
</p>
<p>Where:</p><ul>
<li>\( V_\mathrm{adc_n} \) = voltage sample at index \( n \)</li>
<li>\( I_\mathrm{adc_n-90^\circ} \) = current sample phase-shifted by 90°</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="PowerFactor"></a>
Power Factor (PF)</h2>
<p>The <b>Power Factor (PF)</b> expresses how efficiently power is used and is defined as:   </p><p class="formulaDsp">
\[\mathrm{PF} = \cos(\phi)
\]
</p>
<p>Thus:</p><ul>
<li>Purely Resistive: \( \phi = 0^\circ \Rightarrow \mathrm{PF} = 1 \) <br  />
</li>
<li>Purely Reactive: \( |\phi| = 90^\circ \Rightarrow \mathrm{PF} = 0 \) <br  />
</li>
<li>Mixed Load: \( 0 &lt; |\phi| &lt; 90^\circ \Rightarrow 0 &lt; \mathrm{PF} &lt; 1 \)</li>
</ul>
<p>The easiest way to compute the power factor is using apparent and active power:   </p><p class="formulaDsp">
\[\mathrm{PF} = \cos(\phi) = \frac{S}{P}
\]
</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Energy"></a>
Energy</h1>
<p>Energy is the cumulative measure of total work done or power consumed by a system over time. <br  />
 In AC metrology, we do not compute energy directly from voltage and current samples; instead, we build on previously defined power computations.</p>
<p>Energy computation flow:</p><ol type="1">
<li>Compute average power ( \( P, Q, S \)) over a defined measurement period.</li>
<li>Derive the corresponding energy for that period.</li>
<li>Accumulate these periodic energy values over time to obtain total energy consumption.</li>
</ol>
<p>Instantaneous power is defined as:   </p><p class="formulaDsp">
\[    p(t) = v(t) \cdot i(t) 
\]
</p>
<p>And energy is the integral of power over time:   </p><p class="formulaDsp">
\[    E = \int_0^T p(t) \, dt 
\]
</p>
<p>In a discrete digital system, we process data in finite computation windows of samples ( \( N \)).<br  />
 This means energy per unit time becomes:   </p><p class="formulaDsp">
\[    E = P \cdot \delta
\]
</p>
<p> In a system with a fixed sampling period \( \delta \) becomes \( \frac{1}{f_s} \) and an energy quanta per sampling period can be defined:   </p><p class="formulaDsp">
\[    E_\mathrm{unit} = \frac{P}{f_s}
\]
</p>
<p> Where:</p><ul>
<li>\( P \) = Computed average power.</li>
<li>\( f_s \) = System sampling frequency.</li>
<li>\( E_\mathrm{unit} \) = Energy quanta per ADC sample.</li>
</ul>
<p>And we can use this quanta by incrementing a running total of energy every time a sampling period passes:   </p><p class="formulaDsp">
\[    E_\mathrm{t} = E_\mathrm{t,prev} + E_\mathrm{unit}
\]
</p>
<p> Where:</p><ul>
<li>\( E_\mathrm{t} \) = Current running total of energy.</li>
<li>\( E_\mathrm{t,prev} \) = Previous (before increment) running total of energy.</li>
</ul>
<p>The table below summarises the computation of energy per sampling period (unit) and accumulated totals for active, reactive, and apparent power.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Instantaneous Power  </th><th class="markdownTableHeadNone">Average Power  </th><th class="markdownTableHeadNone">Energy Unit  </th><th class="markdownTableHeadNone">Accumulated Energy Total  </th><th class="markdownTableHeadNone">Units  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Active</b>  </td><td class="markdownTableBodyNone">\( p(t) = v(t) \cdot i(t) \)  </td><td class="markdownTableBodyNone">\( P = \frac{1}{N} \sum_{n=1}^{N} [V_\mathrm{adc_n} \cdot I_\mathrm{adc_n}] \)  </td><td class="markdownTableBodyNone">\( E_\mathrm{active,unit} = \frac{P}{f_s} \)  </td><td class="markdownTableBodyNone">\( E_\mathrm{active,t} = E_\mathrm{active,t,prev} + E_\mathrm{active,unit} \)  </td><td class="markdownTableBodyNone">Ws  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Reactive</b>  </td><td class="markdownTableBodyNone">\( q(t) = v(t) \cdot i(t - 90^\circ) \)  </td><td class="markdownTableBodyNone">\( Q = \frac{1}{N} \sum_{n=1}^{N} [V_\mathrm{adc_n} \cdot I_\mathrm{adc_n-90^\circ}] \)  </td><td class="markdownTableBodyNone">\( E_\mathrm{reactive,unit} = \frac{Q}{f_s} \)  </td><td class="markdownTableBodyNone">\( E_\mathrm{reactive,t} = E_\mathrm{reactive,t,prev} + E_\mathrm{reactive,unit} \)  </td><td class="markdownTableBodyNone">VARs  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Apparent</b>  </td><td class="markdownTableBodyNone">Not Applicable  </td><td class="markdownTableBodyNone">\( S = \frac{1}{N} \sqrt{\sum_{n=1}^{N} V_\mathrm{adc_n}^2 \cdot \sum_{n=1}^{N} I_\mathrm{adc_n}^2} \)  </td><td class="markdownTableBodyNone">\( E_\mathrm{apparent,unit} = \frac{S}{f_s} \)  </td><td class="markdownTableBodyNone">\( E_\mathrm{apparent,t} = E_\mathrm{apparent,t,prev} + E_\mathrm{apparent,unit} \)  </td><td class="markdownTableBodyNone">VAs  </td></tr>
</table>
<p>Where:</p><ul>
<li>\( N \) = number of samples per computation window <br  />
</li>
<li>\( f_s \) = sampling frequency</li>
</ul>
<p>This table provides a compact overview of how each type of energy is calculated per computation window and accumulated over time, including their respective units.</p>
<p>Where:</p><ul>
<li>\( E_\mathrm{active,t} \) is in <b>watt-seconds [Ws]</b></li>
<li>\( E_\mathrm{reactive,t} \) in <b>volt-ampere reactive seconds [VARs]</b></li>
<li>\( E_\mathrm{apparent,t} \) in <b>volt-ampere seconds [VAs]</b></li>
</ul>
<p>To summarise, energy accumulation follows this loop:</p><ol type="1">
<li>Collect \( N \) ADC samples for voltage and current.</li>
<li>Compute average powers \( P, Q, S \) for the computation window.</li>
<li>Convert each power to energy quanta \( E_\mathrm{unit} = \frac{P}{f_s} \).</li>
<li>Accumulate totals for active, reactive, and apparent energy.</li>
<li>Periodically store totals in non-volatile memory to preserve state.</li>
</ol>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Harmonics"></a>
Harmonics</h1>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo</a></b></dt><dd>Describe harmonic analysis, distortion, and total harmonic distortion (THD)</dd></dl>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Filtering"></a>
Filtering</h1>
<p>Filtering is an essential part of digital metrology, removing DC bias, noise, and high-frequency components.</p>
<h2 class="doxsection"><a class="anchor" id="HPF"></a>
HPF</h2>
<p>A <b>High-Pass Filter (HPF)</b> attenuates low frequencies (including DC). Its cutoff frequency, \( f_c \), defines where attenuation begins (–3 dB point).</p>
<p class="formulaDsp">
\[y_n = \alpha y_{n-1} + \alpha (x_n - x_{n-1})
\]
</p>
   <p class="formulaDsp">
\[\alpha = \frac{1}{1 + 2 \pi f_c T_s}
\]
</p>
<p>Where:</p><ul>
<li>\( T_s \) = Sampling Period</li>
</ul>
<p>Used in LMA’s ADC front-end to eliminate DC offsets from amplifiers.</p>
<h2 class="doxsection"><a class="anchor" id="LPF"></a>
LPF</h2>
<p>A <b>Low-Pass Filter (LPF)</b> attenuates high-frequencies. Its cutoff frequency, \( f_c \), defines where attenuation begins (–3 dB point).</p>
<p class="formulaDsp">
\[y_n = \alpha x_n + (1 - \alpha) y_{n-1}
\]
</p>
   <p class="formulaDsp">
\[\alpha = \frac{2 \pi f_c T_s}{1 + 2 \pi f_c T_s}
\]
</p>
<p>Where:</p><ul>
<li>\( T_s \) = Sampling Period</li>
</ul>
<p>LPFs in LMA are used in zero-crossing detection and frequency measurement, and also as hardware anti-aliasing filters.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="Integration"></a>
Integration</h1>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo</a></b></dt><dd>Describe integration, techniques &amp; uses in AC metering.</dd></dl>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
